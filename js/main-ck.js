/*global L: true*//*global TweenMax: true*//*jshint devel:true*/$(document).ready(function(){var e={s:{},init:function(){e.genSet();e.genMap();e.getJson()},genSet:function(){e.s.map=$("#map");e.s.regLoc={"my-location":["",""],auckland:[-36.85,174.7833],otago:[-45.4333,169.8333],christchurch:[-43.5,172.6],dunedin:[-45.89,170.5],hamilton:[-37.7833,175.2833],"hawkes-bay":[-39.4167,176.8167],canterbury:[-43.55,171.22],wellington:[-41.2889,174.7772]};e.s.pin={};e.s.phpData=["blank","blank"];e.s.uQ=$(".user-query");e.s.swpTxt=e.s.uQ.find(".swap-txt");e.s.pCity=e.s.uQ.find(".pick-city").find("ul");e.s.pCuis=e.s.uQ.find(".pick-cuisine").find("ul");e.s.whtOut=$(".white-out")},genMap:function(){console.log("generating map!");var t=L.mapbox.map("map","fairfax.map-2vlbm9o8");t.setView([-41.4395,172.1936],6);e.s.map=t},posMap:function(t){console.log("city array reference = "+t);var n=e.s.map,r=e.s.regLoc,i=r[t][0],s=r[t][1];console.log("");console.log("chosen lat = "+i+" and lng = "+s);console.log("");n.setView([i,s],13)},getJson:function(){$.getJSON("js/restaurant-info.json",function(t){e.s.json=t}).success(function(){}).error(function(){}).complete(function(){console.log("got json");e.genIcon();e.listeners();e.geoLoc()})},genIcon:function(){console.log("generating icons!");var t=e.s.map,n=e.s.json,r=n.length,i=[],s=null,o=null,u=null,a=null,f=null,l=null,c=null,h=null,p=null,d=null;console.log("json length = "+r);for(var v=0;v<r;v++){o=n[v].Latitude;u=n[v].Longitude;f=n[v].Description;l=n[v].Type;c=n[v].Address;h=n[v].Phone;p=n[v].Web;d=n[v].Hours;a=f+"<br>"+l+"<br>"+c+"<br>"+h+"<br>"+p+"<br>"+d;v%100===0?s={type:"Feature",geometry:{type:"Point",coordinates:[u,o]},properties:{"marker-color":"#333333","marker-size":"large",title:"silver-fern-farms",description:"Silver Fern Farms Sponsorship..."+a}}:s={type:"Feature",geometry:{type:"Point",coordinates:[u,o]},properties:{"marker-color":"#129a5f","marker-size":"small",title:"generic-restaurant",description:a}};i.push(s)}t.markerLayer.setGeoJSON(i)},geoLoc:function(){if(!navigator.geolocation)return"";var t=e.s.map,n=e.s.regLoc,r=null,i=null,s=e.s.uQ,o=s.find(".pick-city").find(".swap-txt"),u=o.siblings("ul").find($('li[data-selection="my-location"]'));console.log("we CAN find your location =)");t.locate();t.on("locationfound",function(t){r=t.latlng.lat;i=t.latlng.lng;console.log("-- GPS LOC --");console.log("e.latlng.lng; = "+r);console.log("e.latlng.lng; = "+i);n["my-location"][0]=r;n["my-location"][1]=i;u.css({display:"block"});e.s.phpData=["blank","my-location"];o.text("my location");e.s.regLoc=n})},listeners:function(){console.log("generating listeners!");e.s.uQ.on("click",".swap-txt",function(){e.uiAct.selClick($(this))});e.s.uQ.on("click","li",function(){e.uiAct.selLstClick($(this))})},uiAct:{selClick:function(t){console.log("selection click!");var n=t.closest(".selection").hasClass("pick-city"),r=null,i=null;if(n){r=e.s.pCity;i=e.s.pCuis}else{r=e.s.pCuis;i=e.s.pCity}TweenMax.to(e.s.whtOut,1,{opacity:"0.8",display:"block"});TweenMax.to(r,1,{display:"block",opacity:"1",left:"50%",transform:"translateX(-50%)",top:"60px"});TweenMax.set(i,{display:"none",opacity:"0",left:"0",transform:"translateX(-50%)",top:"0"})},selLstClick:function(t){console.log("selection list click!");var n=t.hasClass("close"),r=t.closest("ul");if(n){TweenMax.to(r,1,{display:"none",opacity:"0",left:"0",transform:"translateX(-50%)",top:"0"});return""}var i=t.text(),s=t.closest(".selection"),o=s.find(".swap-txt"),u=0,a=e.s.phpData;console.log("current selection text = "+o.text());console.log("list item text = "+i);o.text(i);s.hasClass("pick-city")&&(u=1);e.s.phpData[u]=t.attr("data-selection");console.log("cusine = "+e.s.phpData[0]+" | region = "+e.s.phpData[1]);TweenMax.set(r,{display:"none",opacity:"0",left:"0",transform:"translateX(-50%)",top:"0"});if(a[0]!=="blank"&&a[1]!=="blank"){console.log("POPULATE MAP!");e.posMap(a[1]);TweenMax.to(e.s.whtOut,1,{opacity:"0",display:"none"});TweenMax.to(e.s.uQ,1,{boxShadow:"0 20px 20px -20px #999999","font-size":"30px",left:"0",width:"100%",padding:"25px"})}}}};(function(){e.init()})()});