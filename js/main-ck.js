/*global L: true*//*global TweenMax: true*//*jshint devel:true*/$(document).ready(function(){var e={s:{},init:function(){e.genSet();e.genMap();e.getJson()},genSet:function(){e.s.map=$("#map");e.s.pin={};e.s.pin.orgHgt=473;e.s.pin.orgWth=292;e.s.pin.smlRatio=.2;e.s.pin.lrgRatio=.35;e.s.pin.smlHgt=e.s.pin.orgHgt*e.s.pin.smlRatio;e.s.pin.smlWth=e.s.pin.orgWth*e.s.pin.smlRatio;e.s.pin.lrgHgt=e.s.pin.orgHgt*e.s.pin.lrgRatio;e.s.pin.lrgWth=e.s.pin.orgWth*e.s.pin.lrgRatio;e.s.phpData=["blank","blank"];e.s.uQ=$(".user-query");e.s.swpTxt=e.s.uQ.find(".swap-txt");e.s.pCity=e.s.uQ.find(".pick-city").find("ul");e.s.pCuis=e.s.uQ.find(".pick-cuisine").find("ul");e.s.whtOut=$(".white-out")},genMap:function(){console.log("generating map!");var t=L.map("map").setView([-36.85,174.7833],13);L.tileLayer("http://{s}.tile.cloudmade.com/1142b9cbe62a48c6b6e8a86ef4122ab7/997/256/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://cloudmade.com">CloudMade</a>',maxZoom:18}).addTo(t);e.s.map=t},getJson:function(){$.ajax({type:"POST",url:"php/sort-json.php",data:{menuInfo:["Cnr of Victoria & Albert Streets, Auckland","Mai Thai"]},dataType:"json",success:function(t){e.s.json=t;console.log("returned content from php = "+e.s.json);e.genIcon();e.listeners()},error:function(){console.log("json error!")}})},genIcon:function(){console.log("generating icons!");var t=e.s.json,n=t.length,r=e.s.map,i=e.s.pin.smlHgt,s=e.s.pin.smlWth,o=e.s.pin.lrgHgt,u=L.icon({iconUrl:"img/special-pin.png",iconSize:[s,i],iconAnchor:[s/2,i],popupAnchor:[0,(o+5)*-1],shadowUrl:"img/shadow.png",shadowSize:[s,s],shadowAnchor:[s/2,s/2]}),a=L.icon({iconUrl:"img/green-pin.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[0,-45],shadowUrl:"img/marker-shadow.png",shadowSize:[41,41],shadowAnchor:[12,41]}),f=null,l=null,c=null,h=null,p=null,d=null,v=null,m=null,g=null;console.log("json length = "+n);for(var y=0;y<n;y++){f=t[y].Latitude;l=t[y].Longitude;h=t[y].Description;p=t[y].Type;d=t[y].Address;v=t[y].Phone;m=t[y].Web;g=t[y].Hours;c=h+"<br>"+p+"<br>"+d+"<br>"+v+"<br>"+m+"<br>"+g;y%100===0?L.marker([f,l],{icon:u}).addTo(r).bindPopup("<h2>Silver Fern Farms.....</h2>"+c):L.marker([f,l],{icon:a}).addTo(r).bindPopup(c)}},listeners:function(){console.log("generating listeners!");$(".leaflet-marker-icon").on("mouseenter",function(){e.uiAct.iconEnter($(this))});$(".leaflet-marker-icon").on("mouseleave",function(){e.uiAct.iconLeave($(this))});$(".leaflet-marker-icon").on("click",function(){e.uiAct.iconClick($(this))});e.s.uQ.on("click",".swap-txt",function(){e.uiAct.selClick($(this))});e.s.uQ.on("click","li",function(){e.uiAct.selLstClick($(this))})},uiAct:{iconEnter:function(t){console.log("icon enter!");var n=t.attr("src");console.log("image src = "+n);if(n!=="img/special-pin.png"){console.log("NOT SPECIAL PIN!");return""}var r=e.s.pin.lrgHgt,i=e.s.pin.lrgWth,s=e.s.pin.smlHgt,o=e.s.pin.smlWth,u=(r-s)*-1,a=(r-s)/2*-1;TweenMax.to(t,.25,{width:i,height:r,top:u,left:a+15})},iconLeave:function(t){console.log("icon leave!");var n=t.attr("src");console.log("image src = "+n);if(n!=="img/special-pin.png"||t.attr("data-active")==="false"){console.log("NOT SPECIAL PIN!");return""}var r=e.s.pin.smlHgt,i=e.s.pin.smlWth;TweenMax.to(t,.25,{width:i,height:r,top:"0",left:"0",repeat:0,yoyo:!1})},iconClick:function(e){console.log("icon click!");var t=e.attr("src");console.log("image src = "+t);if(t!=="img/special-pin.png"){console.log("NOT SPECIAL PIN!");return""}var n=e.attr("data-active");n==="false"?e.attr({"data-active":"true"}):e.attr({"data-active":"false"})},selClick:function(t){console.log("selection click!");var n=t.closest(".selection").hasClass("pick-city"),r=null,i=null;if(n){r=e.s.pCity;i=e.s.pCuis}else{r=e.s.pCuis;i=e.s.pCity}TweenMax.to(e.s.whtOut,1,{opacity:"0.8",display:"block"});TweenMax.set(r,{display:"block"});TweenMax.to(r,1,{opacity:"1",left:"50%",transform:"translateX(-50%)",top:"60px"});TweenMax.set(i,{display:"none",opacity:"0",left:"0",transform:"translateX(-50%)",top:"0"})},selLstClick:function(t){console.log("selection list click!");var n=t.text(),r=t.closest("ul"),i=t.closest(".selection"),s=i.find(".swap-txt"),o=0,u=e.s.phpData;console.log("current selection text = "+s.text());console.log("list item text = "+n);s.text(n);i.hasClass("pick-city")&&(o=1);e.s.phpData[o]=n;console.log("cusine = "+e.s.phpData[0]+" | region = "+e.s.phpData[1]);TweenMax.set(r,{display:"none",opacity:"0",left:"0",transform:"translateX(-50%)",top:"0"});if(u[0]!=="blank"&&u[1]!=="blank"){console.log("POPULATE MAP!");TweenMax.to(e.s.whtOut,1,{opacity:"0",display:"none"});TweenMax.to(e.s.uQ,1,{"font-size":"30px",left:"0",width:"100%",padding:"25px"})}}}};(function(){e.init()})()});